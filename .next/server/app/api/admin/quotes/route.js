"use strict";(()=>{var e={};e.id=943,e.ids=[943],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},35762:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>q,staticGenerationBailout:()=>h});var s={};r.r(s),r.d(s,{GET:()=>p});var a=r(95419),i=r(69108),o=r(99678),n=r(78070),u=r(81355),l=r(3205),c=r(9108);async function p(e){try{let t=await (0,u.getServerSession)(l.L);if(!t||"admin"!==t.user.role)return n.Z.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),s=r.get("status"),a=parseInt(r.get("page")||"1"),i=parseInt(r.get("limit")||"20"),o=(a-1)*i,p={};s&&(p.status=s);let[d,m]=await Promise.all([c._.quoteRequest.findMany({where:p,include:{customer:{select:{firstName:!0,lastName:!0,user:{select:{email:!0}}}},assignedTechnician:{select:{firstName:!0,lastName:!0,companyName:!0}},job:{select:{id:!0,status:!0}}},orderBy:{createdAt:"desc"},skip:o,take:i}),c._.quoteRequest.count({where:p})]);return await c._.adminActivity.create({data:{adminId:t.user.id,action:"viewed_quotes",details:{status:s,page:a}}}),n.Z.json({quotes:d,pagination:{total:m,page:a,pages:Math.ceil(m/i)}})}catch(e){return console.error("Error fetching quotes:",e),n.Z.json({error:"Failed to fetch quotes"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/quotes/route",pathname:"/api/admin/quotes",filename:"route",bundlePath:"app/api/admin/quotes/route"},resolvedPagePath:"C:\\Users\\12244\\OneDrive\\Documents\\Kuiperpros\\app\\api\\admin\\quotes\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:q,serverHooks:g,headerHooks:x,staticGenerationBailout:h}=d,w="/api/admin/quotes/route";function y(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:q})}},3205:(e,t,r)=>{r.d(t,{L:()=>o});var s=r(86485),a=r(9108),i=r(7529);let o={providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await a._.user.findUnique({where:{email:e.email},include:{customer:!0,technician:!0}});return t&&t.passwordHash&&await i.ZP.compare(e.password,t.passwordHash)?{id:t.id,email:t.email,role:t.role,name:t.customer?.firstName||t.technician?.firstName||"User"}:null}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(e?.user&&(e.user.id=t.id,e.user.role=t.role),e)},pages:{signIn:"/login",error:"/auth/error"},session:{strategy:"jwt"}}},9108:(e,t,r)=>{r.d(t,{_:()=>a});let s=require("@prisma/client"),a=global.prisma||new s.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,147,70],()=>r(35762));module.exports=s})();